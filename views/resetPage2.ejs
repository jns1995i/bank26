<% layout('layout') %>
<style>
    .sidef {
        display: none !important;
    }
    .mainf {
        width: 100% !important;
        padding: 0 !important;
    }
    body {
        padding: 0 !important;
        gap: 0;
    }
      @media (max-width: 900px) {
        .fcrdX {
            width: 95% !important;
        }
      }
</style>

<div class="abstractBG col gap10">
    <section class="liquid width30 fcrdX col padding20">
        <p class="size20">Welcome, <%= user.fName %></p>
        <p class="size14 textCenter textBalance">Before you proceed, you need to create a new password</p>
    </section>
    <section class="padding0 corner15 width30 col bgWhite shadow1 fcrdX">
        <div class="bgWhite col padding20 justifyStart alignStart colorPrimary relative fcrd" id="">
            <section class="bgViolet100 col alignStart">
                    <p class="size14">Take Note! Password must contain the following:</p>
                    <p class="size14">&bull; Atleast 1 Special Character</p>
                    <p class="size14">&bull; Atleast 1 Upper Case Letter</p>
                    <p class="size14">&bull; Combination of Letter and Numbers</p>
                    <p class="size14">&bull; Minimum of 8 characters</p>
            </section>
            <br>
            <form action="/rst2FG" method="POST" class="padding0 corner0 gap5">
                <div class="field password width100">
                    <label for="">Temporary Password</label>
                    <input type="password" name="currentPass" id="currentPass" required>
                    <span class="showPass" id="showPass" style="cursor: pointer;">show</span>
                </div>
                <div class="height0 col alignStart">
                    <p class="bgGreen100 hidden" id="warning1"><i class="fas fa-check-circle"></i> Password Verified!</p>
                    <span class="bgRed100 hidden" id="warning2"><i class="fas fa-exclamation-circle"></i> Incorrect Password!</span>
                </div>
                <div class="field password">
                    <label for="">Create Password</label>
                    <input type="password" name="createPass" id="createPass" required>
                    <span class="showPass" id="showPass" style="cursor: pointer;">show</span>
                </div>
                <div class="height0 col alignStart">
                    <p class="bgGreen100 hidden" id="warning3"><i class="fas fa-check-circle"></i> Strong Password!</p>
                    <span class="bgRed100 hidden" id="warning4"><i class="fas fa-exclamation-circle"></i> Weak Password!</span>
                </div>
                <div class="field password">
                    <label for="">Confirm Password</label>
                    <input type="password" name="confirmPass" id="confirmPass" required>
                    <span class="showPass" id="showPass" style="cursor: pointer;">show</span>
                </div>
                <div class="height0 col alignStart">
                    <p class="bgGreen100 hidden" id="warning5"><i class="fas fa-check-circle"></i> Password Confirmed!</p>
                    <span class="bgRed100 hidden" id="warning6"><i class="fas fa-exclamation-circle"></i> Password Didn't Matched!</span>
                </div>
                <div class="field alignEnd">
                    <button type="submit" class="nav pnav w100"><i class="fas fa-check-circle"></i>Submit</button>
                </div>
            </form>
        </div>

    </section>
</div>


<script>
    const currentPass = document.getElementById('currentPass');
    const warning1 = document.getElementById('warning1'); // correct
    const warning2 = document.getElementById('warning2'); // incorrect

    const createPass = document.getElementById('createPass');
    const warning3 = document.getElementById('warning3'); // strong
    const warning4 = document.getElementById('warning4'); // weak

    const confirmPass = document.getElementById('confirmPass');
    const warning5 = document.getElementById('warning5'); // matched
    const warning6 = document.getElementById('warning6'); // not matched


    // 1. CHECK CURRENT PASSWORD (LIVE)
    currentPass.addEventListener('keyup', function () {
        fetch('/check-pass', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ currentPass: this.value })
        })
        .then(res => res.json())
        .then(data => {
            if (this.value === "") {
                warning1.classList.add('hidden');
                warning2.classList.add('hidden');
                return;
            }

            if (data.valid) {
                warning1.classList.remove('hidden');
                warning2.classList.add('hidden');
            } else {
                warning2.classList.remove('hidden');
                warning1.classList.add('hidden');
            }
        });
    });


    // 2. CHECK NEW PASSWORD STRENGTH
    createPass.addEventListener('keyup', function () {
        const pass = this.value;

        const hasUpper = /[A-Z]/.test(pass);
        const hasSpecial = /[\W_]/.test(pass);
        const hasNumber = /\d/.test(pass);
        const longEnough = pass.length >= 8;

        if (pass === "") {
            warning3.classList.add('hidden');
            warning4.classList.add('hidden');
            return;
        }

        if (hasUpper && hasSpecial && hasNumber && longEnough) {
            warning3.classList.remove('hidden'); // strong
            warning4.classList.add('hidden');
        } else {
            warning4.classList.remove('hidden'); // weak
            warning3.classList.add('hidden');
        }
    });


    // 3. CONFIRM PASSWORD MATCH
    confirmPass.addEventListener('keyup', function () {
        if (this.value === "") {
            warning5.classList.add('hidden');
            warning6.classList.add('hidden');
            return;
        }

        if (this.value === createPass.value) {
            warning5.classList.remove('hidden');
            warning6.classList.add('hidden');
        } else {
            warning6.classList.remove('hidden');
            warning5.classList.add('hidden');
        }
    });

</script>