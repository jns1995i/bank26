 <% if ( request.holdAt ) { %>
                <section class=" padding0 relative marginTop15">
                    <p class="absolute right5 top0" style="transform: rotate(45deg)!important;"><i class="fas fa-thumbtack size16"></i></p>
                    <section class="bgYellow textCenter colorPrimary col corner20 padding10" style="min-height: 60px;">
                        Request has been hold! Remarks: "<%= request.remarks %>"
                    </section>
                </section>
                <% } else if ( request.declineAt ) { %>
                <section class=" padding0 relative col marginTop15">
                    <p class="absolute right5 top0" style="transform: rotate(45deg)!important;"><i class="fas fa-thumbtack size16"></i></p>
                    <section class="bgYellow textCenter colorPrimary col corner20 padding10" style="min-height: 60px;">
                        Request has been declined due to
                        <% if ( request.remarks === "Incomplete") { %>
                            Incomplete
                        <% } else if ( request.remarks === "Balance") { %>
                            Balance
                        <% } else { %>
                            <%= request.remarks %>
                        <% } %>
                </section>
                <% } else { %>
                <section class="padding0 relative marginTop15 hidden">
                    <section class="bgYellow textCenter darkGray corner14 padding20" style="min-height: 40px;">
                        <p class="size14 str500"><i class="fas fa-info-circle"></i>
                        <% if (request.status === "Pending") { %>
                        Documents Require Action!
                        <% } else if (request.status === "Reviewed") { %>
                        Request has been forwarded to the Accounting Department for assessment.
                        <% } else if (request.status === "Assessed") { %>
                            Waiting for payment
                        <% } else if (request.status === "For Verification") { %>
                            Accounting is verifying the payment ..
                        <% } else if (request.status === "Verified") { %>
                            Payment verified. Proceed with document preparation.</p>
                        <% } else if (request.status === "For Release") { %>
                                Upon claiming the requested documents, student must present the QR CODE below.
                        <% } else if (request.status === "Claimed") { %>
                            Transaction Success! Document has been claimed: <%= request.claimedAtFormatted %> by <%= request.claimedBy %>
                        <% } else { %>
                        <% } %>
                        </p>
                    </section>
                </section>
                <% } %>
                            <script>
                                document.addEventListener('DOMContentLoaded', () => {
                                    const downloadBtn = document.querySelector('.qrBtn');
                                    const canvasEl = document.getElementById('qrcodeCanvas');

                                    if (!downloadBtn || !canvasEl) return;

                                    downloadBtn.addEventListener('click', () => {
                                        // Convert canvas to data URL first
                                        const dataURL = canvasEl.toDataURL('image/png');

                                        // Detect iPhone/iPad
                                        const isIOS = /iP(hone|od|ad)/i.test(navigator.userAgent);

                                        if (isIOS) {
                                            // iOS does NOT support download attribute for data URLs
                                            // Solution: open the image in a new tab
                                            const tab = window.open();
                                            tab.document.write(
                                                `<img src="${dataURL}" style="width:100%;height:auto;" />`
                                            );
                                            return;
                                        }

                                        // Desktop + Android: force download
                                        const link = document.createElement('a');
                                        link.href = dataURL;
                                        link.download = 'qrcode.png';

                                        // Must be added to DOM for some mobile browsers
                                        document.body.appendChild(link);

                                        link.click();

                                        document.body.removeChild(link);
                                    });
                                });
                            </script>
                            <script>
                                // Format the data into a readable string indicating transaction verification
                                const requestDataFormatted = `Transaction Verified! 
                                Name: ${"<%= request.requestBy?.fName %>"} ${"<%= request.requestBy?.mName %>"} ${"<%= request.requestBy?.lName %>"} ${"<%= request.requestBy?.xName %>"},
                                Role: ${"<%= request.requestBy?.role %>"},
                                Course: ${"<%= request.requestBy?.course %>"},
                                TR: ${"<%= request.tr %>"}`;
                            
                                // Generate the QR code with formatted data
                                const canvas = document.getElementById('qrcodeCanvas');
                                QRCode.toCanvas(canvas, requestDataFormatted, function (error) {
                                    if (error) {
                                        console.error(error);
                                    } else {
                                        console.log('QR code generated successfully');
                                    }
                                });
                            </script>