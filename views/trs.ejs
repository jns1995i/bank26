<% layout('layout') %>


<section class="justifyBetween">
  <p class="size30 medium">Book Transactions (Internal Ledger)</p>
  <div class="area0 padding0 gap10">
    <input type="search" class="marginLeft5" name="" id="univ" placeholder="Search here ..">
    <a href="javascript:void(0)" class="nav pnav" id="newTRbtn"><i class="fas fa-plus"></i> Add Record</a>
  </div>
</section>

<br>

<p class="noFound noteGray size18 width0" style="display:none;">No results found.</p>

<table cellpadding="10" class="tCard" id="book">
  <thead>
    <tr style="background-color: #f2f2f2;">
      <th>Date</th>
      <th>Fund</th> <th>Voucher No.</th> <th>Check No.</th> <th>Description/Payee</th>
      <th>Amount</th>
      <th>Type</th>
      <th>Status</th> </tr>
  </thead>
  <tbody>
    <% if (trs && trs.length) { %>
      <% trs.forEach(tr => { %>
        <tr>
          <td><%= tr.dateFormatted %></td>
          <td><strong><%= tr.accountType %></strong></td> <td><%= tr.voucherNo || 'N/A' %></td>
          <td><%= tr.checkNo || '---' %></td>
          <td><%= tr.desc %></td>
          <td><%= tr.amount.toLocaleString(undefined, { minimumFractionDigits: 2 }) %></td>
          <td><%= tr.type %></td>
          <td>
             <span class="<%= tr.status === 'Reconciled' ? 'noteGreen' : 'noteGray' %>">
               <%= tr.status %>
             </span>
          </td>
        </tr>
      <% }) %>
    <% } else { %>
      <tr><td colspan="8" style="text-align:center;">No transactions found.</td></tr>
    <% } %>
  </tbody>
</table>


<div class="col fixed right0 bgWhite shadow2 justifyStart top0 padding20 unseen" id="newTRCard">
    <form action="/newTR" method="POST" class="">

        <div class="field">
            <p class="size30 medium">Add New Record</p>
        </div>

        <div class="field">
            <label for="">Date</label>
            <input type="date" name="date" required>
        </div>

        <div class="field">
            <label for="">Account / Fund Type</label>
            <select name="accountType" required>
                <option value="">-- Select Fund --</option>
                <option value="GOF">GOF (General Operating Fund)</option>
                <option value="CPF">CPF (Corporate Partnership Fund)</option>
                <option value="RCA">RCA (Rice Collection Account)</option>
                <option value="MSC">MSC (Miscellaneous)</option>
            </select>
        </div>

        <div class="field">
            <label for="">Voucher No.</label>
            <input type="text" name="voucherNo" placeholder="e.g. 25-11-1496">
        </div>

        <div class="field">
            <label for="">Check No.</label>
            <input type="text" name="checkNo" placeholder="e.g. 1723917">
        </div>

        <div class="field">
            <label for="">Description / Remarks</label>
            <textarea name="desc" required placeholder="Who was paid and for what?"></textarea>
        </div>

        <div class="field">
            <label for="">Amount</label>
            <input type="number" name="amount" step="0.01" required placeholder="0.00">
        </div>

        <div class="field">
            <label for="">Entry Type:</label>
            <select name="type" required>
                <option value="Debit">Debit (Disbursement)</option>
                <option value="Credit">Credit (Collection)</option>
            </select>
        </div>
        <br>

        <div class="height0 justifyBetween padding0">
            <a href="" class="nav wpx150">Cancel</a>
            <button class="nav wpx150 pnav" type="submit">Add to Record</button>
        </div>

    </form>

</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('newTRbtn');
    const card = document.getElementById('newTRCard');

    if (!btn || !card) return;

    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      card.classList.remove('unseen');
      card.classList.add('seen');
    });

    card.addEventListener('click', (e) => {
      e.stopPropagation();
    });

    document.addEventListener('click', () => {
      card.classList.remove('seen');
      card.classList.add('unseen');
    });
  });
</script>

<script>
const searchInput = document.getElementById('univ');
const table = document.querySelector('.tCard');          // ✅ table
const rows = document.querySelectorAll('.tCard tbody tr');
const noFound = document.querySelector('.noFound');

searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    let visibleCount = 0;

    rows.forEach(row => {
        if (row.textContent.toLowerCase().includes(query)) {
            row.style.display = '';
            visibleCount++;
        } else {
            row.style.display = 'none';
        }
    });

    // ✅ toggle table + noFound
    if (visibleCount === 0) {
        table.style.display = 'none';
        noFound.style.display = 'block';
    } else {
        table.style.display = '';
        noFound.style.display = 'none';
    }
});
</script>

